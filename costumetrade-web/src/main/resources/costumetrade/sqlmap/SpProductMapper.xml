<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="costumetrade.order.mapper.SpProductMapper">
  <resultMap id="BaseResultMap" type="costumetrade.order.domain.SpProduct">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="corpId" jdbcType="INTEGER" property="corpid" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="code" jdbcType="VARCHAR" property="code" />
    <result column="brandId" jdbcType="INTEGER" property="brandid" />
    <result column="prductType" jdbcType="INTEGER" property="prducttype" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="fastcode" jdbcType="VARCHAR" property="fastcode" />
    <result column="barcode" jdbcType="VARCHAR" property="barcode" />
    <result column="barcodes" jdbcType="VARCHAR" property="barcodes" />
    <result column="grade" jdbcType="VARCHAR" property="grade" />
    <result column="unit" jdbcType="VARCHAR" property="unit" />
    <result column="colors" jdbcType="VARCHAR" property="colors" />
    <result column="sizes" jdbcType="VARCHAR" property="sizes" />
    <result column="handcount" jdbcType="INTEGER" property="handcount" />
    <result column="year" jdbcType="VARCHAR" property="year" />
    <result column="season" jdbcType="VARCHAR" property="season" />
    <result column="salTag" jdbcType="VARCHAR" property="saltag" />
    <result column="salMonth" jdbcType="DECIMAL" property="salmonth" />
    <result column="image" jdbcType="VARCHAR" property="image" />
    <result column="image1" jdbcType="VARCHAR" property="image1" />
    <result column="image2" jdbcType="VARCHAR" property="image2" />
    <result column="image3" jdbcType="VARCHAR" property="image3" />
    <result column="image4" jdbcType="VARCHAR" property="image4" />
    <result column="description" jdbcType="VARCHAR" property="description" />
    <result column="warn_low" jdbcType="DOUBLE" property="warnLow" />
    <result column="warn_high" jdbcType="DOUBLE" property="warnHigh" />
    <result column="time_up" jdbcType="TIMESTAMP" property="timeUp" />
    <result column="time_down" jdbcType="TIMESTAMP" property="timeDown" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="create_by" jdbcType="VARCHAR" property="createBy" />
    <result column="modify_time" jdbcType="TIMESTAMP" property="modifyTime" />
    <result column="modify_by" jdbcType="VARCHAR" property="modifyBy" />
    <result column="subId" jdbcType="INTEGER" property="subid" />
  </resultMap>
  
  <resultMap id="ProductsResultMap" type="costumetrade.order.query.ProductQuery">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="code" jdbcType="VARCHAR" property="productCode" />
    <result column="name" jdbcType="VARCHAR" property="productName" />
    <result column="image" jdbcType="VARCHAR" property="image" />
    <result column="time_up" jdbcType="TIMESTAMP" property="timeUp" />
    <result column="subId" jdbcType="INTEGER" property="storeId" />
    <result column="price" jdbcType="DECIMAL" property="price" />
  </resultMap>
  
  <resultMap id="ProductResultMap" type="costumetrade.order.query.ProductDetailQuery">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="code" jdbcType="VARCHAR" property="productCode" />
    <result column="name" jdbcType="VARCHAR" property="productName" />
    <result column="image" jdbcType="VARCHAR" property="image" />
    <result column="time_up" jdbcType="TIMESTAMP" property="timeUp" />
    <result column="subId" jdbcType="INTEGER" property="subId" />
    <result column="corpid" jdbcType="DECIMAL" property="corpid" />
    <result column="brand" jdbcType="VARCHAR" property="brand" />
    <result column="prducttype" jdbcType="VARCHAR" property="prducttype" />
    <result column="colors" jdbcType="VARCHAR" property="colors" />
    <result column="sizes" jdbcType="VARCHAR" property="sizes" />
    <result column="handcount" jdbcType="INTEGER" property="handcount" />
    <result column="year" jdbcType="VARCHAR" property="year" />
    <result column="season" jdbcType="VARCHAR" property="season" />
    <result column="image1" jdbcType="VARCHAR" property="image1" />
    <result column="image2" jdbcType="VARCHAR" property="image2" />
    <result column="image3" jdbcType="VARCHAR" property="image3" />
    <result column="image4" jdbcType="VARCHAR" property="image4" />
    <result column="description" jdbcType="VARCHAR" property="description" />
    <result column="time_down" jdbcType="TIMESTAMP" property="timeDown" />
    <result column="storeName" jdbcType="VARCHAR" property="storeName" />
    <result column="storeImage" jdbcType="VARCHAR" property="storeImage" />
    <result column="salePrice" jdbcType="DECIMAL" property="salePrice" />
    <result column="originalPrice" jdbcType="DECIMAL" property="originalPrice" />
  </resultMap>
  
  <sql id="Base_Column_List">
    id, corpId, status, code, brandId, prductType, name, fastcode, barcode, barcodes, 
    grade, unit, colors, sizes, handcount, year, season, salTag, salMonth, image, image1, 
    image2, image3, image4, description, warn_low, warn_high, time_up, time_down, create_time, 
    create_by, modify_time, modify_by, subId
  </sql>
  <sql id="Products_Column_List">
    id,subId,code,name,image,time_up,price
  </sql>
  
  
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from sp_product
    where id = #{id,jdbcType=INTEGER}
  </select>
  
  <select id="selectProducts" parameterType="costumetrade.order.query.ProductParam" resultMap="ProductsResultMap">
    select 
  	product.id,product.subId,product.code,product.name,product.image,product.time_up,
  	(case 
  			when c.saleType == 1 then price1.tagPrice 
  			when c.saleType == 2 then price1.wholePrice 
  			when c.saleType == 3 then price1.packPrice
  			when c.saleType == 3 then price1.retailPrice) price
    from sp_product_#{storeId,jdbcType=INTEGER} product
    left join sp_pcolor_custom color on color.corpId = product.corpId and color.id = product.colors
    left join sp_psize_custom size on size.corpId = product.corpId and size.id = product.sizes
    left join ss_pprice_#{storeId,jdbcType=INTEGER} price1 on price1.productId = product.id and price1.storeId = product.corpId
    left join (select customType.saleType,client.storeId from sp_client_#{storeId,jdbcType=INTEGER} client 
    							left join sp_customer_type customType on customType.id = client.cate
    							where  client.id = #{clientId,jdbcType=INTEGER} ) c on c.storeId = product.corpId 
    left join sp_pbrand brand on brand.id = product.brandId
    left join sp_product_type productType on productType.id = product.prductType
    where 1=1
    and product.time_down &gt;= CURDATE() 
    and product.status == 0
     <if test="productCode != null">
      and  product.code like '%'+#{productCode}+'%'
      </if>
     <if test="productType != null">
       and productType.value in <foreach collection="productType" item="item" index="index" open="(" separator="," close=")"> #{item}</foreach>
      </if>
     <if test="productBrand != null">
       and brand.brandName in <foreach collection="productBrand" item="item" index="index" open="(" separator="," close=")"> #{item}</foreach>
      </if>
      <if test="productSeason != null">
       and product.season in <foreach collection="productSeason" item="item" index="index" open="(" separator="," close=")"> #{item}</foreach>
      </if>
      <if test="TimeUpOp == 'asc'">
        order by product.time_up asc
      </if>
      <if test="TimeUpOp == 'desc'">
        order by product.time_up desc
      </if>
      <if test="priceOp == 'asc'">
        order by price asc
      </if>
      <if test="priceOp == 'desc'">
        order by price desc
      </if>
  </select>
  <select id="selectProduct" parameterType="costumetrade.order.query.KeyParam" resultMap="ProductResultMap">
    select 
  	product.id,product.subId,product.code,product.name,product.image,product.time_up,
  	(case 
  			when c.saleType == 1 then price1.tagPrice 
  			when c.saleType == 2 then price1.wholePrice 
  			when c.saleType == 3 then price1.packPrice
  			when c.saleType == 3 then price1.retailPrice) salePrice,
  	price1.wholePrice as originalPrice,
  	product.corpid,
  	brand.brandName as brand,
  	productType.value as prducttype,
  	color.value   as colors,
  	size.value    as sizes,
  	product.handcount, product.description,store.name as storeName,store.storePhoto as storeImage
  	product.year , product.season, product.image1, product.image2, product.image3, product.image4
    from sp_product_#{storeId,jdbcType=INTEGER} product
    left join sp_pcolor_custom color on color.corpId = product.corpId and color.id = product.colors
    left join sp_psize_custom size on size.corpId = product.corpId and size.id = product.sizes
    left join ss_pprice_#{storeId,jdbcType=INTEGER} price1 on price1.productId = product.id and price1.storeId = product.corpId
    left join (select customType.saleType,client.storeId from sp_client_#{storeId,jdbcType=INTEGER} client 
    							left join sp_customer_type customType on customType.id = client.cate
    							where  client.id = #{clientId,jdbcType=INTEGER} ) c on c.storeId = product.corpId 
    left join sp_pbrand brand on brand.id = product.brandId
    left join sp_product_type productType on productType.id = product.prductType
    left join sp_store store on store.id = product.subId
    where 1=1
    and product.time_down &gt;= CURDATE() 
    and product.status == 0
     
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from sp_product
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="costumetrade.order.domain.SpProduct">
    insert into sp_product (id, corpId, status, 
      code, brandId, prductType, 
      name, fastcode, barcode, 
      barcodes, grade, unit, 
      colors, sizes, handcount, 
      year, season, salTag, 
      salMonth, image, image1, 
      image2, image3, image4, 
      description, warn_low, warn_high, 
      time_up, time_down, create_time, 
      create_by, modify_time, modify_by, 
      subId)
    values (#{id,jdbcType=INTEGER}, #{corpid,jdbcType=INTEGER}, #{status,jdbcType=INTEGER}, 
      #{code,jdbcType=VARCHAR}, #{brandid,jdbcType=INTEGER}, #{prducttype,jdbcType=INTEGER}, 
      #{name,jdbcType=VARCHAR}, #{fastcode,jdbcType=VARCHAR}, #{barcode,jdbcType=VARCHAR}, 
      #{barcodes,jdbcType=VARCHAR}, #{grade,jdbcType=VARCHAR}, #{unit,jdbcType=VARCHAR}, 
      #{colors,jdbcType=VARCHAR}, #{sizes,jdbcType=VARCHAR}, #{handcount,jdbcType=INTEGER}, 
      #{year,jdbcType=VARCHAR}, #{season,jdbcType=VARCHAR}, #{saltag,jdbcType=VARCHAR}, 
      #{salmonth,jdbcType=DECIMAL}, #{image,jdbcType=VARCHAR}, #{image1,jdbcType=VARCHAR}, 
      #{image2,jdbcType=VARCHAR}, #{image3,jdbcType=VARCHAR}, #{image4,jdbcType=VARCHAR}, 
      #{description,jdbcType=VARCHAR}, #{warnLow,jdbcType=DOUBLE}, #{warnHigh,jdbcType=DOUBLE}, 
      #{timeUp,jdbcType=TIMESTAMP}, #{timeDown,jdbcType=TIMESTAMP}, #{createTime,jdbcType=TIMESTAMP}, 
      #{createBy,jdbcType=VARCHAR}, #{modifyTime,jdbcType=TIMESTAMP}, #{modifyBy,jdbcType=VARCHAR}, 
      #{subid,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="costumetrade.order.domain.SpProduct">
  <selectKey resultType="java.lang.Integer" order="AFTER" keyProperty="id">
SELECT LAST_INSERT_ID() AS id
</selectKey>
    insert into sp_product_#{corpid,jdbcType=INTEGER}
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="corpid != null">
        corpId,
      </if>
      <if test="status != null">
        status,
      </if>
      <if test="code != null">
        code,
      </if>
      <if test="brandid != null">
        brandId,
      </if>
      <if test="prducttype != null">
        prductType,
      </if>
      <if test="name != null">
        name,
      </if>
      <if test="fastcode != null">
        fastcode,
      </if>
      <if test="barcode != null">
        barcode,
      </if>
      <if test="barcodes != null">
        barcodes,
      </if>
      <if test="grade != null">
        grade,
      </if>
      <if test="unit != null">
        unit,
      </if>
      <if test="colors != null">
        colors,
      </if>
      <if test="sizes != null">
        sizes,
      </if>
      <if test="handcount != null">
        handcount,
      </if>
      <if test="year != null">
        year,
      </if>
      <if test="season != null">
        season,
      </if>
      <if test="saltag != null">
        salTag,
      </if>
      <if test="salmonth != null">
        salMonth,
      </if>
      <if test="image != null">
        image,
      </if>
      <if test="image1 != null">
        image1,
      </if>
      <if test="image2 != null">
        image2,
      </if>
      <if test="image3 != null">
        image3,
      </if>
      <if test="image4 != null">
        image4,
      </if>
      <if test="description != null">
        description,
      </if>
      <if test="warnLow != null">
        warn_low,
      </if>
      <if test="warnHigh != null">
        warn_high,
      </if>
      <if test="timeUp != null">
        time_up,
      </if>
      <if test="timeDown != null">
        time_down,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="createBy != null">
        create_by,
      </if>
      <if test="modifyTime != null">
        modify_time,
      </if>
      <if test="modifyBy != null">
        modify_by,
      </if>
      <if test="subid != null">
        subId,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="corpid != null">
        #{corpid,jdbcType=INTEGER},
      </if>
      <if test="status != null">
        #{status,jdbcType=INTEGER},
      </if>
      <if test="code != null">
        #{code,jdbcType=VARCHAR},
      </if>
      <if test="brandid != null">
        #{brandid,jdbcType=INTEGER},
      </if>
      <if test="prducttype != null">
        #{prducttype,jdbcType=INTEGER},
      </if>
      <if test="name != null">
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="fastcode != null">
        #{fastcode,jdbcType=VARCHAR},
      </if>
      <if test="barcode != null">
        #{barcode,jdbcType=VARCHAR},
      </if>
      <if test="barcodes != null">
        #{barcodes,jdbcType=VARCHAR},
      </if>
      <if test="grade != null">
        #{grade,jdbcType=VARCHAR},
      </if>
      <if test="unit != null">
        #{unit,jdbcType=VARCHAR},
      </if>
      <if test="colors != null">
        #{colors,jdbcType=VARCHAR},
      </if>
      <if test="sizes != null">
        #{sizes,jdbcType=VARCHAR},
      </if>
      <if test="handcount != null">
        #{handcount,jdbcType=INTEGER},
      </if>
      <if test="year != null">
        #{year,jdbcType=VARCHAR},
      </if>
      <if test="season != null">
        #{season,jdbcType=VARCHAR},
      </if>
      <if test="saltag != null">
        #{saltag,jdbcType=VARCHAR},
      </if>
      <if test="salmonth != null">
        #{salmonth,jdbcType=DECIMAL},
      </if>
      <if test="image != null">
        #{image,jdbcType=VARCHAR},
      </if>
      <if test="image1 != null">
        #{image1,jdbcType=VARCHAR},
      </if>
      <if test="image2 != null">
        #{image2,jdbcType=VARCHAR},
      </if>
      <if test="image3 != null">
        #{image3,jdbcType=VARCHAR},
      </if>
      <if test="image4 != null">
        #{image4,jdbcType=VARCHAR},
      </if>
      <if test="description != null">
        #{description,jdbcType=VARCHAR},
      </if>
      <if test="warnLow != null">
        #{warnLow,jdbcType=DOUBLE},
      </if>
      <if test="warnHigh != null">
        #{warnHigh,jdbcType=DOUBLE},
      </if>
      <if test="timeUp != null">
        #{timeUp,jdbcType=TIMESTAMP},
      </if>
      <if test="timeDown != null">
        #{timeDown,jdbcType=TIMESTAMP},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createBy != null">
        #{createBy,jdbcType=VARCHAR},
      </if>
      <if test="modifyTime != null">
        #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifyBy != null">
        #{modifyBy,jdbcType=VARCHAR},
      </if>
      <if test="subid != null">
        #{subid,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="costumetrade.order.domain.SpProduct">
    update sp_product
    <set>
      <if test="corpid != null">
        corpId = #{corpid,jdbcType=INTEGER},
      </if>
      <if test="status != null">
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="code != null">
        code = #{code,jdbcType=VARCHAR},
      </if>
      <if test="brandid != null">
        brandId = #{brandid,jdbcType=INTEGER},
      </if>
      <if test="prducttype != null">
        prductType = #{prducttype,jdbcType=INTEGER},
      </if>
      <if test="name != null">
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="fastcode != null">
        fastcode = #{fastcode,jdbcType=VARCHAR},
      </if>
      <if test="barcode != null">
        barcode = #{barcode,jdbcType=VARCHAR},
      </if>
      <if test="barcodes != null">
        barcodes = #{barcodes,jdbcType=VARCHAR},
      </if>
      <if test="grade != null">
        grade = #{grade,jdbcType=VARCHAR},
      </if>
      <if test="unit != null">
        unit = #{unit,jdbcType=VARCHAR},
      </if>
      <if test="colors != null">
        colors = #{colors,jdbcType=VARCHAR},
      </if>
      <if test="sizes != null">
        sizes = #{sizes,jdbcType=VARCHAR},
      </if>
      <if test="handcount != null">
        handcount = #{handcount,jdbcType=INTEGER},
      </if>
      <if test="year != null">
        year = #{year,jdbcType=VARCHAR},
      </if>
      <if test="season != null">
        season = #{season,jdbcType=VARCHAR},
      </if>
      <if test="saltag != null">
        salTag = #{saltag,jdbcType=VARCHAR},
      </if>
      <if test="salmonth != null">
        salMonth = #{salmonth,jdbcType=DECIMAL},
      </if>
      <if test="image != null">
        image = #{image,jdbcType=VARCHAR},
      </if>
      <if test="image1 != null">
        image1 = #{image1,jdbcType=VARCHAR},
      </if>
      <if test="image2 != null">
        image2 = #{image2,jdbcType=VARCHAR},
      </if>
      <if test="image3 != null">
        image3 = #{image3,jdbcType=VARCHAR},
      </if>
      <if test="image4 != null">
        image4 = #{image4,jdbcType=VARCHAR},
      </if>
      <if test="description != null">
        description = #{description,jdbcType=VARCHAR},
      </if>
      <if test="warnLow != null">
        warn_low = #{warnLow,jdbcType=DOUBLE},
      </if>
      <if test="warnHigh != null">
        warn_high = #{warnHigh,jdbcType=DOUBLE},
      </if>
      <if test="timeUp != null">
        time_up = #{timeUp,jdbcType=TIMESTAMP},
      </if>
      <if test="timeDown != null">
        time_down = #{timeDown,jdbcType=TIMESTAMP},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createBy != null">
        create_by = #{createBy,jdbcType=VARCHAR},
      </if>
      <if test="modifyTime != null">
        modify_time = #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifyBy != null">
        modify_by = #{modifyBy,jdbcType=VARCHAR},
      </if>
      <if test="subid != null">
        subId = #{subid,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="costumetrade.order.domain.SpProduct">
    update sp_product
    set corpId = #{corpid,jdbcType=INTEGER},
      status = #{status,jdbcType=INTEGER},
      code = #{code,jdbcType=VARCHAR},
      brandId = #{brandid,jdbcType=INTEGER},
      prductType = #{prducttype,jdbcType=INTEGER},
      name = #{name,jdbcType=VARCHAR},
      fastcode = #{fastcode,jdbcType=VARCHAR},
      barcode = #{barcode,jdbcType=VARCHAR},
      barcodes = #{barcodes,jdbcType=VARCHAR},
      grade = #{grade,jdbcType=VARCHAR},
      unit = #{unit,jdbcType=VARCHAR},
      colors = #{colors,jdbcType=VARCHAR},
      sizes = #{sizes,jdbcType=VARCHAR},
      handcount = #{handcount,jdbcType=INTEGER},
      year = #{year,jdbcType=VARCHAR},
      season = #{season,jdbcType=VARCHAR},
      salTag = #{saltag,jdbcType=VARCHAR},
      salMonth = #{salmonth,jdbcType=DECIMAL},
      image = #{image,jdbcType=VARCHAR},
      image1 = #{image1,jdbcType=VARCHAR},
      image2 = #{image2,jdbcType=VARCHAR},
      image3 = #{image3,jdbcType=VARCHAR},
      image4 = #{image4,jdbcType=VARCHAR},
      description = #{description,jdbcType=VARCHAR},
      warn_low = #{warnLow,jdbcType=DOUBLE},
      warn_high = #{warnHigh,jdbcType=DOUBLE},
      time_up = #{timeUp,jdbcType=TIMESTAMP},
      time_down = #{timeDown,jdbcType=TIMESTAMP},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      create_by = #{createBy,jdbcType=VARCHAR},
      modify_time = #{modifyTime,jdbcType=TIMESTAMP},
      modify_by = #{modifyBy,jdbcType=VARCHAR},
      subId = #{subid,jdbcType=INTEGER}
    where id = #{id,jdbcType=INTEGER}
  </update>
</mapper>